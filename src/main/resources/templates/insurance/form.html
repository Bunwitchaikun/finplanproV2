<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(~{::title}, ~{::main})}">
<head>
    <title>Insurance Management</title>
</head>
<body>
<main role="main">
    <div class="container-fluid">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h3" th:text="${policy.id == null ? 'Add New Policy' : 'Edit Policy'}"></h1>
            <a th:href="@{/insurance/list}" class="btn btn-outline-primary">
                <i class="bi bi-list-ul me-2"></i>View All Policies
            </a>
        </div>

        <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
        
        <div class="row g-4">
            <!-- Form Column -->
            <div class="col-lg-8">
                <div class="card shadow-sm border-0">
                    <div class="card-body p-4">
                        <form th:action="@{/insurance}" th:object="${policy}" method="post">
                            <input type="hidden" th:field="*{id}" />
                            <div class="mb-3">
                                <label for="policyNumber" class="form-label">Policy Number</label>
                                <input type="text" class="form-control" id="policyNumber" th:field="*{policyNumber}" required>
                                <div th:if="${#fields.hasErrors('policyNumber')}" th:errors="*{policyNumber}" class="text-danger mt-1"></div>
                            </div>
                            <hr>
                            <h5 class="mb-3">Coverage Details</h5>
                            <div class="row g-3">
                                <div class="col-md-6"><label>Life Coverage</label><input type="number" step="0.01" class="form-control" th:field="*{lifeCoverage}"></div>
                                <div class="col-md-6"><label>Disability Coverage</label><input type="number" step="0.01" class="form-control" th:field="*{disabilityCoverage}"></div>
                                <div class="col-md-4"><label>Health - Room</label><input type="number" step="0.01" class="form-control" th:field="*{healthCareRoom}"></div>
                                <div class="col-md-4"><label>Health - Per Visit</label><input type="number" step="0.01" class="form-control" th:field="*{healthCarePerVisit}"></div>
                                <div class="col-md-4"><label>Health - OPD</label><input type="number" step="0.01" class="form-control" th:field="*{healthCareOpd}"></div>
                                <div class="col-md-6"><label>Daily Compensation</label><input type="number" step="0.01" class="form-control" th:field="*{dailyCompensation}"></div>
                                <div class="col-md-6"><label>Critical Illness</label><input type="number" step="0.01" class="form-control" th:field="*{criticalIllnessCoverage}"></div>
                            </div>
                            <hr>
                            <h5 class="mb-3">Premiums</h5>
                            <div class="row g-3">
                                <div class="col-md-6"><label>Main Premium</label><input type="number" step="0.01" class="form-control" th:field="*{mainPremium}"></div>
                                <div class="col-md-6"><label>Rider(s) Premium</label><input type="number" step="0.01" class="form-control" th:field="*{riderPremium}"></div>
                            </div>
                            <hr class="my-4">
                            <button type="submit" class="btn btn-primary px-4" th:text="${policy.id == null ? 'Save Policy' : 'Update Policy'}"></button>
                            <a th:href="@{/insurance}" class="btn btn-secondary px-4" th:if="${policy.id != null}">Cancel Edit</a>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Summary Column -->
            <div class="col-lg-4">
                <div class="card shadow-sm border-0">
                    <div class="card-header bg-transparent"><h5 class="mb-0">Total Summary</h5></div>
                    <div class="card-body" th:object="${summary}">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between"><span>Life Coverage:</span> <strong th:text="${#numbers.formatCurrency(summary.totalLifeCoverage)}"></strong></li>
                            <li class="list-group-item d-flex justify-content-between"><span>Disability:</span> <strong th:text="${#numbers.formatCurrency(summary.totalDisabilityCoverage)}"></strong></li>
                            <li class="list-group-item d-flex justify-content-between"><span>Critical Illness:</span> <strong th:text="${#numbers.formatCurrency(summary.totalCriticalIllnessCoverage)}"></strong></li>
                            <li class="list-group-item d-flex justify-content-between"><span>Total Premium:</span> <strong th:text="${#numbers.formatCurrency(summary.totalPremium)}"></strong></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
</body>
</html>
