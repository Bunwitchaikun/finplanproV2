<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(~{::title}, ~{::main})}">
<head>
    <title>ระบบคำนวณภาษี</title>
</head>
<body>
<main role="main">
    <div class="container-fluid">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h3">ระบบคำนวณภาษี (Tax Calculator)</h1>
            <a th:href="@{/tax/list}" class="btn btn-outline-primary">
                <i class="bi bi-list-ul me-2"></i>View Saved Records
            </a>
        </div>
        
        <div th:if="${errorMessage}" class="alert alert-warning" th:text="${errorMessage}"></div>

        <!-- Main Form for both calculation and saving -->
        <form th:action="@{/tax/calculate}" th:object="${taxRequest}" method="post" id="tax-form">
            <div class="card shadow-sm border-0">
                <div class="card-body p-4">
                    <!-- All input fields go here -->
                    <h5 class="card-title mb-4">1. รายได้และค่าใช้จ่าย</h5>
                    <div class="row g-3 border-bottom pb-4 mb-4">
                        <div class="col-md-4">
                            <label for="taxYear" class="form-label">ปีภาษี</label>
                            <input type="number" class="form-control" th:field="*{taxYear}" required>
                        </div>
                        <div class="col-md-4">
                            <label for="monthlyIncome" class="form-label">กรุณาใส่รายได้ต่อเดือนของคุณ (THB):</label>
                            <input type="number" step="0.01" class="form-control" th:field="*{monthlyIncome}" placeholder="e.g., 30000">
                        </div>
                        <div class="col-md-4">
                            <label for="customExpense" class="form-label">กรุณาระบุค่าใช้จ่ายรายปีเพิ่มเติม (THB):</label>
                            <input type="number" step="0.01" class="form-control" th:field="*{customExpense}" placeholder="e.g., 5000">
                        </div>
                        <div class="col-md-12">
                            <label for="incomeType" class="form-label">เลือกประเภทของรายได้:</label>
                            <select class="form-select" th:field="*{incomeType}">
                                <option value="เงินได้จากเงินเดือน โบนัส ค่าล่วงเวลา (Salary)">เงินได้จากเงินเดือน โบนัส ค่าล่วงเวลา (Salary)</option>
                                <option value="เงินได้จากค่านายหน้า รับจ้างทำงาน (Commision)">เงินได้จากค่านายหน้า รับจ้างทำงาน (Commision)</option>
                                <option value="เงินได้จากค่าลิขสิทธิ์ สิทธิบัตร (Goodwill)">เงินได้จากค่าลิขสิทธิ์ สิทธิบัตร (Goodwill)</option>
                                <option value="เงินได้จากดอกเบี้ย เงินปันผล ส่วนแบ่งกำไร (Interest&Dividends)">เงินได้จากดอกเบี้ย เงินปันผล ส่วนแบ่งกำไร (Interest&Dividends)</option>
                                <option value="เงินได้จากค่าเช่าทรัพย์สิน (Rent)">เงินได้จากค่าเช่าทรัพย์สิน (Rent)</option>
                                <option value="เงินได้จากการเป็นวิชาชีพอิสระ (Profession)">เงินได้จากการเป็นวิชาชีพอิสระ (Profession)</option>
                                <option value="เงินได้จากการรับเหมา (Constructor)">เงินได้จากการรับเหมา (Constructor)</option>
                                <option value="เงินได้อื่นๆ (Others)">เงินได้อื่นๆ (Others)</option>
                            </select>
                        </div>
                    </div>

                    <h5 class="card-title mb-4">2. ค่าลดหย่อนและข้อมูลครอบครัว</h5>
                    <div class="row g-3 border-bottom pb-4 mb-4">
                        <div class="col-md-3">
                            <label class="form-label">กรุณาใส่จำนวนบุตรที่มี (ถ้ามี):</label>
                            <input type="number" class="form-control" th:field="*{children}" min="0">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">กรุณาใส่จำนวนการคลอดบุตร (ในปีปฎิทิน):</label>
                            <input type="number" class="form-control" th:field="*{childbirth}" min="0">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">กรุณาใส่จำนวนพ่อแม่ที่ยังมีชีวิต (ถ้ามี):</label>
                            <input type="number" class="form-control" th:field="*{parents}" min="0" max="2">
                        </div>
                        <div class="col-md-3 d-flex flex-column justify-content-center pt-4">
                            <div class="form-check"><input class="form-check-input" type="checkbox" th:field="*{spouse}"><label class="form-check-label">คุณมีคู่สมรสหรือไม่? :</label></div>
                            <div class="form-check"><input class="form-check-input" type="checkbox" th:field="*{disability}"><label class="form-check-label">คุณมีผู้พิการในครอบครัวหรือไม่? :</label></div>
                        </div>
                    </div>

                    <h5 class="card-title mb-4">3. ประกันและกองทุนต่าง ๆ</h5>
                    <div class="row g-3">
                        <div class="col-md-4 col-lg-3"><div class="form-check form-switch"><input class="form-check-input" type="checkbox" role="switch" th:field="*{lifeInsurance}"><label class="form-check-label">คุณมีประกันชีวิตทั่วไปหรือไม่? :</label></div></div>
                        <div class="col-md-4 col-lg-3"><div class="form-check form-switch"><input class="form-check-input" type="checkbox" role="switch" th:field="*{healthInsuranceSelf}"><label class="form-check-label">คุณมีประกันสุขภาพตัวเองหรือไม่? :</label></div></div>
                        <div class="col-md-4 col-lg-3"><div class="form-check form-switch"><input class="form-check-input" type="checkbox" role="switch" th:field="*{healthInsuranceParents}"><label class="form-check-label">คุณมีประกันสุขภาพสำหรับพ่อแม่หรือไม่? :</label></div></div>
                        <div class="col-md-4 col-lg-3"><div class="form-check form-switch"><input class="form-check-input" type="checkbox" role="switch" th:field="*{pension}"><label class="form-check-label">คุณมีเบี้ยประกันบำนาญหรือไม่? :</label></div></div>
                        <div class="col-md-4 col-lg-3"><div class="form-check form-switch"><input class="form-check-input" type="checkbox" role="switch" th:field="*{providentFund}"><label class="form-check-label">คุณมีเงินในกองทุนสำรองเลี้ยงชีพ / กบข. หรือไม่? :</label></div></div>
                        <div class="col-md-4 col-lg-3"><div class="form-check form-switch"><input class="form-check-input" type="checkbox" role="switch" th:field="*{rmf}"><label class="form-check-label">คุณมีเงินในกองทุนรวมเพื่อการเลี้ยงชีพ RMF หรือไม่? :</label></div></div>
                        <div class="col-md-4 col-lg-3"><div class="form-check form-switch"><input class="form-check-input" type="checkbox" role="switch" th:field="*{ssf}"><label class="form-check-label">คุณมีเงินในกองทุนรวมเพื่อการออม (SSF) หรือไม่? :</label></div></div>
                        <div class="col-md-4 col-lg-3"><div class="form-check form-switch"><input class="form-check-input" type="checkbox" role="switch" th:field="*{socialSecurity}"><label class="form-check-label">คุณมีเงินในกองทุนการออมแห่งชาติ (กอช.) หรือไม่? :</label></div></div>
                    </div>
                    
                    <hr class="my-4">
                    <button type="submit" class="btn btn-primary btn-lg px-5">คำนวณภาษี</button>
                </div>
            </div>
        </form>

        <!-- Result Section -->
        <div th:if="${showResult}" class="mt-4">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-success text-white"><h5 class="mb-0">ผลการคำนวณ</h5></div>
                <div class="card-body p-4">
                    <dl class="row">
                        <dt class="col-sm-4">รายได้ทั้งปี</dt>
                        <dd class="col-sm-8" th:text="${#numbers.formatDecimal(taxResult.annualIncome, 1, 'COMMA', 2, 'POINT')} + ' THB'"></dd>
                        <dt class="col-sm-4">ค่าใช้จ่ายที่หักได้</dt>
                        <dd class="col-sm-8" th:text="${#numbers.formatDecimal(taxResult.totalExpenseDeduction, 1, 'COMMA', 2, 'POINT')} + ' THB'"></dd>
                        <dt class="col-sm-4">ค่าลดหย่อนรวม</dt>
                        <dd class="col-sm-8" th:text="${#numbers.formatDecimal(taxResult.totalAllowance, 1, 'COMMA', 2, 'POINT')} + ' THB'"></dd>
                        <dt class="col-sm-4">เงินได้สุทธิ</dt>
                        <dd class="col-sm-8 fw-bold" th:text="${#numbers.formatDecimal(taxResult.netIncome, 1, 'COMMA', 2, 'POINT')} + ' THB'"></dd>
                        <hr class="my-2">
                        <dt class="col-sm-4 h4">จำนวนภาษีที่ต้องจ่าย</dt>
                        <dd class="col-sm-8 h4 text-danger fw-bold" th:text="${#numbers.formatDecimal(taxResult.taxAmount, 1, 'COMMA', 2, 'POINT')} + ' THB'"></dd>
                    </dl>
                    <hr>
                    <form th:action="@{/tax/save}" th:object="${taxRequest}" method="post">
                        <button type="submit" class="btn btn-success px-4">
                            <i class="bi bi-save me-2"></i>บันทึกข้อมูลการคำนวณนี้
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</main>
</body>
</html>
